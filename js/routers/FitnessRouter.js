define(["jquery","backbone","fitness","customCodeClient","models/ChallengeModel","views/FooterView","views/HomeView","views/FriendsView","views/LoginView","views/RegisterView","views/ProfileView","views/AuthView","views/ChallengeView","jquerymobile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=t.Router.extend({initialize:function(){this.loginView=new a({el:"#login"}),this.registerView=new f({el:"#register"}),t.history.start()},routes:{"":"whereTo",home:"showHome",login:"showLogin",create:"showCreate",profile:"showProfile",friends:"showFriends",register:"showRegister",auth:"showAuth"},ensureLogin:function(e){if(n.isLoggedIn()){e(!0);return}var t=localStorage.getItem("username");if(!t){e(!1);return}n.loginWithID(t,function(t){e(t);return})},whereTo:function(){var t=this;this.ensureLogin(function(i){if(!i){t.showLogin();return}if(n.user&&n.user.get("accesstoken"))t.showHome();else if(window.location.href.indexOf("oauth_token")!==-1){var o=localStorage.getItem("request_token");if(!o){n.showMessage("Missing Fitbit request token.");var u=new s({el:"#auth .footer"});e.mobile.loading("show"),this.showAuth();return}var a=localStorage.getItem("request_token_secret"),f=r.getQueryVariable(window.location.href,"oauth_verifier"),l=f.length-1;f[l]==="/"&&(f=f.substring(0,l).replace("#","")),r.completeFitbitAuth(n.user,o,a,f,function(r,i){if(r){var o=i;n.user.set("accesstoken",o.oauth_token),n.user.set("accesstokensecret",o.oauth_token_secret),n.user.set("fitbituserid",o.fitbit_user_id),localStorage.removeItem("request_token"),localStorage.removeItem("request_token_secret"),t.showHome();var u=new s({el:"#home .footer"});e.mobile.changePage("#home",{reverse:!1,changeHash:!0})}else localStorage.removeItem("request_token"),localStorage.removeItem("request_token_secret"),n.showMessage(i)})}else t.showAuth()})},showHome:function(){var t=this;this.ensureLogin(function(r){if(!r){t.showLogin();return}if(n.user&&n.user.get("accesstoken")){t.homeView=new o({el:"#home"});var i=new s({el:"#home .footer"});e.mobile.changePage("#home",{reverse:!0,changeHash:!0})}else t.showAuth()})},showActiveChallenges:function(){var t=new s({el:"#profile .footer"});e.mobile.changePage("#profile",{reverse:!1,changeHash:!0})},showProfile:function(){var t=this;this.ensureLogin(function(n){if(!t.profileView){t.profileView=new l({el:"#profile"});var r=new s({el:"#profile .footer"})}e.mobile.changePage("#profile",{reverse:!1,changeHash:!0})})},showLogin:function(){var t=new s({el:"#login .footer"});e.mobile.changePage("#login",{reverse:!1,changeHash:!0})},showRegister:function(){var t=new s({el:"#register .footer"});e.mobile.changePage("#register",{reverse:!1,changeHash:!0})},showAuth:function(){var t=this;this.ensureLogin(function(n){if(!n){t.showLogin();return}if(!t.authView){var r=new s({el:"#auth .footer"});t.authView=new c({el:"#auth"})}e.mobile.changePage("#auth",{reverse:!1,changeHash:!0})})},showCreate:function(){var t=this;this.ensureLogin(function(n){if(!n){t.showLogin();return}if(!t.challengeView){t.challengeView=new h({el:"#create"});var r=new s({el:"#create .footer"})}e.mobile.changePage("#create",{reverse:!0,changeHash:!0})})},showFriends:function(){var t=this;this.ensureLogin(function(n){if(!n){t.showLogin();return}if(!t.friendsView){t.friendsView=new u({el:"#friends"});var r=new s({el:"#friends .footer"})}e.mobile.changePage("#friends",{reverse:!0,changeHash:!0})})}});return d});